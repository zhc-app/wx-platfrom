<!DOCTYPE html>
<html style="background-color: #f5f5f5;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>个人信息</title>
    <link rel="stylesheet" type="text/css" href="../../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../../../css/aui.css"/>
    <link rel="stylesheet" href="../../../script/jedate/skin/jedate.css" media="screen" title="no title">
    <style>
    .aui-list .aui-list-item-title {
        font-size: 0.8rem;
        position: relative;
        max-width: 100%;
        color: #333333;
        margin-left: 5px;
    }

    .aui-list .aui-list-item-right{
         max-width: 100%;
        position: relative;
        font-size: 0.6rem;
        color: #757575;
        margin-left: 0.25rem;
    }
    table{
      text-align: center;
      margin-top: 0.5rem;
      width: 100%;
    }
    td{
      width: 25%;
      padding: 0.5rem 0;
    }
    .left_line {
        background-color: #6666ff;
        height: 18px;
        width: 4px;
        margin-top: auto;
        margin-bottom: auto;
        float: left;
    }
    .section_title {
        color: #333333;
        font-size: 16px;
        font-family: "PingFang-SC";
        margin-left: 10px;
        margin-top: auto;
        margin-bottom: auto;
    }
    .workinput{
      text-align: right;
      position: absolute;
      right: 1.5rem;
      font-size: 14px !important;
    }
    </style>
</head>

<body>
    <!-- <div class="empty"> -->
<div id="" class="flex-wrap flex-vertical " style="padding-bottom: 50px;padding-top: 0px;">

  <section class="aui-content" id="center_ul">
    <script id="center_s" type="text/x-dot-template">
    <ul class="aui-list aui-list-in aui-margin-b-15">
        <li class="aui-list-item" >
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">头像</div>
                <div class="aui-list-item-right">
                  <input type="file" class="file" id="fileInput" multiple accept="image/*" style="display: none;" />
                  <img class="real_tou" src="http://www.yxke12.com/Public/Home/images/touxiang/{{=it.img}}" style='width:3rem;height:3rem;margin:0.5rem 0;border-radius:1.5rem;' id="tou_img" alt="">
                </div>
            </div>
        </li>
    </ul>

      <ul  class="aui-list aui-list-in aui-margin-b-15">
          <li class="aui-list-item">
              <div class="aui-list-item-inner ">
                  <div class="aui-list-item-title">用户名</div>
                  <div class="aui-list-item-right">{{=it.loginname}}</div>
              </div>
          </li>
          <li class="aui-list-item">
              <div class="aui-list-item-inner ">
                  <div class="aui-list-item-title">所在地区</div>
                  <div class="aui-list-item-right">{{=it.sheng}}</div>
              </div>
          </li>

          <li class="aui-list-item" style="display: none">
              <div class="aui-list-item-inner ">
                  <div class="aui-list-item-title">学籍号</div>
                  <div class="aui-list-item-right">{{=it.enrollmentno}}</div>
              </div>
          </li>
          <li class="aui-list-item" style="display: none">
              <div class="aui-list-item-inner ">
                  <div class="aui-list-item-title">入学年份</div>
                  <div class="aui-list-item-right">{{=it.nianji}}</div>
              </div>
          </li>
          <li class="aui-list-item">
              <div class="aui-list-item-inner ">
                  <div class="aui-list-item-title">中考成绩</div>
                  {{if (it.msexamscore==""||it.msexamscore==null||it.msexamscore==undefined) {}}
                    <div class="aui-list-item-right">请到电脑端填写</div>
                  {{}else{}}
                    <div class="aui-list-item-right">{{=it.msexamscore}}</div>
                  {{}}}

              </div>
          </li>


      </ul>
      <ul class="aui-list aui-list-in aui-margin-b-15">


            <li class="aui-list-item" style="display: none">
                <div class="aui-list-item-inner ">
                    <div class="aui-list-item-title">学校</div>
                    <div class="aui-list-item-right">{{=it.school}}</div>
                </div>
            </li>
            <li class="aui-list-item" style="display: none">

                <div class="aui-list-item-inner ">
                    <div class="aui-list-item-title">年级</div>
                    {{if (it.grade==null||it.grade==""||it.grade==undefined) {}}
                      <div class="aui-list-item-right" id="grade">该校暂未设置分班</div>
                    {{}else {}}
                      <div class="aui-list-item-right" id="grade">{{=it.grade}}</div>
                    {{}}}

                </div>
            </li>
            <li class="aui-list-item" style="display: none">
                <div class="aui-list-item-inner ">
                    <div class="aui-list-item-title">班级</div>
                    {{if (it.grade==null||it.grade==""||it.grade==undefined) {}}
                    <div class="aui-list-item-right" id="class">
                        该校暂未设置分班
                    </div>
                    {{}else {}}
                    <div class="aui-list-item-right" id="class">
                        {{=it.class}}
                    </div>
                    {{}}}

                </div>
            </li>

      </ul>
      <ul class="aui-list aui-list-in aui-margin-b-15">

                <li class="aui-list-item">

                    <div class="aui-list-item-inner ">
                        <div class="aui-list-item-title">学生姓名</div>
                        <div class="aui-list-item-right">{{=it.studentname}}</div>
                    </div>
                </li>
                <li class="aui-list-item">

                    <div class="aui-list-item-inner ">
                        <div class="aui-list-item-title">性别</div>
                        <div class="aui-list-item-right">{{=it.sex}}</div>
                    </div>
                </li>
                
                <li class="aui-list-item" id="bir">
                    <div class="aui-list-item-inner aui-list-item-arrow">
                        <div class="aui-list-item-title" >出生日期</div>
                          <input type="text" class="workinput" id="inpstart" value='2017-01-01' readonly >
                    </div>
                </li>
                <li class="aui-list-item">
                    <div class="aui-list-item-inner ">
                        <div class="aui-list-item-title">考试类型</div>
                        <div class="aui-list-item-right">{{=it.type}}</div>
                    </div>
                </li>


      </ul>
      <ul class="aui-list aui-list-in aui-margin-b-15">

              <li class="aui-list-item" tapmode onclick="onTelClick()">

                  <div class="aui-list-item-inner ">
                      <div class="aui-list-item-title">手机号</div>
                      {{if (it.hideTel == null || it.hideTel == '' || it.hideTel == undefined) {}}
                        <div class="aui-list-item-right">暂无</div>
                      {{}else {}}
                        <div class="aui-list-item-right">{{=it.hideTel}}</div>
                      {{}}}

                  </div>
              </li>
              <li class="aui-list-item">
                  <div class="aui-list-item-inner ">
                      <div class="aui-list-item-title">身高</div>
                      {{if (it.height==""||it.height==null||it.height==undefined) {}}
                        <div class="aui-list-item-right">请到电脑端填写</div>
                      {{}else{}}
                      <div class="aui-list-item-right" >
                          {{=it.height}}
                      </div>
                      {{}}}

                  </div>
              </li>
              <li class="aui-list-item">
                  <div class="aui-list-item-inner ">
                      <div class="aui-list-item-title">体重</div>
                      {{if (it.weight==""||it.weight==null||it.weight==undefined) {}}
                        <div class="aui-list-item-right">请到电脑端填写</div>
                      {{}else{}}
                      <div class="aui-list-item-right" >
                          {{=it.weight}}
                      </div>
                      {{}}}

                  </div>
              </li>
              <li class="aui-list-item">
                  <div class="aui-list-item-inner ">
                      <div class="aui-list-item-title">特长</div>
                      {{if (it.specialty==""||it.specialty==null||it.specialty==undefined) {}}
                        <div class="aui-list-item-right">请到电脑端填写</div>
                      {{}else{}}
                      <div class="aui-list-item-right" id="class">
                          {{=it.specialty}}
                      </div>
                      {{}}}

                  </div>
              </li>

      </ul>
    </script>

  </section>



<!-- 经历 -->

<section class="aui-content"  id="wodejili">
  <div style="margin-left:5%;margin-top:10px;height:auto;display: inline-flex;">
      <div class="left_line"></div>
      <div class="section_title">经历</div>
  </div>
  <table  id="xsjl">
    <script id="jl" type="text/x-dot-template">
          <tr style="border-top: 1px solid #e5e5e5;border-bottom: 1px solid #e5e5e5;">
            <td>起始时间</td>
            <td>终止时间</td>
            <td>所在学校</td>
            <td>证明人</td>
          </tr>
          <tr style="background:#fff;border-bottom: 1px solid #e5e5e5;">
          {{if (it.startime==""||it.startime==null||it.startime==undefined) {}}
              <td>--</td>
          {{}else {}}
              <td>{{=it.startime}}</td>
          {{}}}
          {{if (it.endtime==""||it.endtime==null||it.endtime==undefined) {}}
              <td>--</td>
          {{}else {}}
              <td>{{=it.endtime}}</td>
          {{}}}
          {{if (it.suozaixuexiao==""||it.suozaixuexiao==null||it.suozaixuexiao==undefined) {}}
              <td>--</td>
          {{}else {}}
              <td>{{=it.suozaixuexiao}}</td>
          {{}}}
          {{if (it.zhengmingren==""||it.zhengmingren==null||it.zhengmingren==undefined) {}}
              <td>--</td>
          {{}else {}}
              <td>{{=it.zhengmingren}}</td>
          {{}}}

          </tr>
          <tr style="background:#fff;border-bottom: 1px solid #e5e5e5;">
          {{if (it.startime1==""||it.startime1==null||it.startime1==undefined) {}}
              <td>--</td>
          {{}else {}}
            <td>{{=it.startime1}}</td>
          {{}}}
          {{if (it.endtime1==""||it.endtime1==null||it.endtime1==undefined) {}}
              <td>--</td>
          {{}else {}}
            <td>{{=it.endtime1}}</td>
          {{}}}
          {{if (it.suozaixuexiao1==""||it.suozaixuexiao1==null||it.suozaixuexiao1==undefined) {}}
              <td>--</td>
          {{}else {}}
            <td>{{=it.suozaixuexiao1}}</td>
          {{}}}
          {{if (it.zhengmingren1==""||it.zhengmingren1==null||it.zhengmingren1==undefined) {}}
              <td>--</td>
          {{}else {}}
            <td>{{=it.zhengmingren1}}</td>
          {{}}}

          </tr>
          <tr style="background:#fff;border-bottom: 1px solid #e5e5e5;">
          {{if (it.startime2==""||it.startime2==null||it.startime2==undefined) {}}
              <td>--</td>
          {{}else {}}
            <td>{{=it.startime2}}</td>
          {{}}}
          {{if (it.endtime2==""||it.endtime2==null||it.endtime2==undefined) {}}
              <td>--</td>
          {{}else {}}
            <td>{{=it.endtime2}}</td>
          {{}}}
          {{if (it.suozaixuexiao2==""||it.suozaixuexiao2==null||it.suozaixuexiao2==undefined) {}}
              <td>--</td>
          {{}else {}}
            <td>{{=it.suozaixuexiao2}}</td>
          {{}}}
          {{if (it.zhengmingren2==""||it.zhengmingren2==null||it.zhengmingren2==undefined) {}}
              <td>--</td>
          {{}else {}}
            <td>{{=it.zhengmingren2}}</td>
          {{}}}

          </tr>
      </script>
  </table>
</section>
</div>
<!-- <li class="aui-list-item">
    <div class="aui-list-item-inner aui-list-item-arrow">
        <div class="aui-list-item-title">考试类型</div>
        <div class="aui-list-item-right">
          <select class="aui-list-item-right" onchange="onTypeChange(this.value)">
            {{if (it.type == '文科') {}}
              <option value="0" selected = "selected">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp文科</option>
              <option value="1" >&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp理科</option>
              <option value="2">文理不分科</option>
            {{}else if (it.type == '理科') {}}
              <option value="0">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp文科</option>
              <option value="1" selected = "selected" >&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp理科</option>
              <option value="2">文理不分科</option>
            {{}else {}}
              // 文理不分
              <option value="0">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp文科</option>
              <option value="1">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp理科</option>
              <option value="2" selected = "selected">文理不分科</option>
            {{}}}
          </select>
        </div>
    </div>
</li> -->
<canvas id="myCanvas" style="display: none"></canvas>
<img id="my_img" src="" alt="">
</div>
</body>
  <script type="text/javascript" src="../../../script/jquery-1.11.1.min.js"></script>
  <script type="text/javascript" src="../../../script/zhc-route.js"></script>
  <script type="text/javascript" src="../../../script/aui-toast.js"></script>
  <script type="text/javascript" src="../../../script/api.js"></script>
  <script type="text/javascript" src="../../../script/doT.js"></script>
  <script type="text/javascript" src="../../../script/network.js"></script>
  <script type="text/javascript" src="../../../script/tools.js"></script>
  <script type="text/javascript" src='../../../script/jedate/jquery.jedate.js'></script>
<script type="text/javascript">
    var data = {};
    var cur_pic = null;
    var cur_type = null;
    var new_type = null;
    var center_dot=doT.template(document.getElementById('center_s').innerHTML);
    var xsjl1=doT.template(document.getElementById('jl').innerHTML);
    var toast = new auiToast({});
    window.onload = function(){
        getData();
        setCurData();

        if ($api.getStorage('jsons')==""||$api.getStorage('jsons')==null||$api.getStorage('jsons')==undefined) {
          $api.byId('wodejili').style.display="none";
        }else {
          $api.byId('wodejili').style.display="block";
          var jldata = $api.getStorage('jsons')
          var jlDate =$api.strToJson(jldata);
          document.getElementById('xsjl').innerHTML = xsjl1(jlDate);
        }
         //上传图片
        //第一种方式：createObjectURL
        //图片上传预览功能
      var userAgent = navigator.userAgent;//用于判断浏览器类型
      $(".file").change(function () {
          //获取选择图片的对象
          var docObj =$(this)[0];
          var picDiv=$(this).parents(".tou_icon");
          //得到所有的图片文件
          var fileList = docObj.files;
          if (fileList.length > 1) {
            toast.fail({
              title:"只能选择一张图片"
            })
            return
          }
          //循环遍历
          for (var i = 0; i < fileList.length; i++) {
              $(".real_tou").attr("id","img"+fileList[i].name);
              // picDiv.prepend(picHtml);
              cur_pic = fileList[i];
              uploadData();
              //获取图片imgi的对象
              var imgObjPreview = document.getElementById("img"+fileList[i].name);
              if (fileList && fileList[i]) {
                  //图片属性
                  // imgObjPreview.src = docObj.files[0].getAsDataURL();
                  //火狐7以上版本不能用上面的getAsDataURL()方式获取，需要以下方式
                  if(userAgent.indexOf('MSIE') == -1){//IE以外浏览器
                      imgObjPreview.src = window.URL.createObjectURL(docObj.files[i]);   //获取上传图片文件的物理路径
                  }else{//IE浏览器
                      if(docObj.value.indexOf(",")!=-1){
                          var srcArr=docObj.value.split(",");
                          imgObjPreview.src = srcArr[i];
                      }else{
                          imgObjPreview.src = docObj.value;
                      }
                  }
              }
          }
      });

      $(".real_tou").click(function(event) {
          $(".file").click();
      });

      $('#inpstart').jeDate(start);
      if (data.birthday == null || data.birthday == '' || data.birthday == undefined){
        $api.byId('inpstart').value = '2017-01-01'
      }else {
        $api.byId('inpstart').value = data.birthday
        // $('#inpstart').html(data.birthday)
      }
    };

    function setCurData() {
        cur_type = data.type;
        new_type = data.type;
    }

    function getData() {
      // img
     
      data.img = $api.getStorage('img');
      data.insuranceno = $api.getStorage('insuranceno');
      data.enrollmentno = $api.getStorage('enrollmentno');
      data.msexamscore = $api.getStorage('msexamscore');
      data.height = $api.getStorage('height');
      data.weight = $api.getStorage('weight');
      data.specialty = $api.getStorage('specialty');
      // loginname
      data.loginname = $api.getStorage('loginname');
      // studentname
      data.studentname = $api.getStorage('studentname');
      // sex
      data.sex = $api.getStorage('sex');
      // nianji
      data.nianji = $api.getStorage('nianji');
      // sheng
      data.banji = $api.getStorage('banji');
      // type
      data.type = $api.getStorage('type');
      // sheng
      data.sheng = $api.getStorage('sheng');
      data.nianji = $api.getStorage('nianji');

      // school
      data.school = $api.getStorage('school');
      data.grade = $api.getStorage('grade');
      data.class = $api.getStorage('banji');
      data.birthday = $api.getStorage('birthday');
      data.tel = $api.getStorage('tel');
      if (data.tel != null && tools.isPhone(data.tel)) {
          data.hideTel = tools.hidePhone(data.tel);
      }
      document.getElementById('center_ul').innerHTML = center_dot(data);
    }
    var type_arr = ['文科', '理科', '文理不分科'];


    function onTypeChange(value) {
        new_type = type_arr[value];
        uploadData()
    }

    function uploadData() {
      // // 调用函数处理图片 　　　　　　　　　　　　　　　　
      // dealImage(cur_pic.path, {
      // // 注意：在pc端可以用绝对路径或相对路径，移动端最好用绝对路径（因为用take photo后的图片路径，我没有试成功（如果有人试成功了可以分享一下经验））
      //  width : 200,
      //  height:200
      // }, function(base){
      // //直接将获取到的base64的字符串，放到一个image标签中就可看到测试后的压缩之后的样式图了
      //  // document.getElementById("transform").src = base;
      //  document.body.prepend("压缩后：" + base.length / 1024 + " " + base)
      // })
        var canvas = document.getElementById("myCanvas");
        var context = canvas.getContext("2d");

        var file=cur_pic;
        var reader=new FileReader();
        var image=new Image();
 
        reader.readAsDataURL(file);
        reader.onload=function(){
            // 通过 reader.result 来访问生成的 DataURL
            var url=reader.result;
            image.src=url;
            image.height =120;
            image.width =120; 
            canvas.setAttribute("width", image.width+"px");
            canvas.setAttribute("height", image.height+"px");
            context.drawImage(image,0,0,image.width,image.height);
            var base64 = canvas.toDataURL('image/png');
            // console.log(dataURLtoBlob(base64))
            // cur_pic = encodeURIComponent(base64);
            cur_pic = base64;
            // $api.byId("my_img").src = base64
            var params = {studentid: $api.getStorage('studentid'),
                  type: new_type,file:cur_pic, imgBase64: cur_pic}
            zhc.ajax('http://www.yxke12.com/index.php/App/Member/editinfo.html',
              params, function (_data) {
                  toast.success({
                    title:"修改成功"
                  })
                  if (_data.touxiang != null) {
                    data.img = _data.touxiang;
                    $api.setStorage('img', _data.touxiang);
                  }

                  if (_data.type != null) {
                    data.type = _data.type;
                    cur_type = _data.type;
                    $api.setStorage('type', cur_type);
                  }else{
                    new_type = cur_type;
                  }
                  document.getElementById('center_ul').innerHTML = center_dot(data);
              }, null, true)
        };
      
    }

    function dataURLtoBlob(dataurl) {
        var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
            bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
        while(n--){
            u8arr[n] = bstr.charCodeAt(n);
        }
        return new Blob([u8arr], {type:mime});
    }

    function dealImage(path, obj, callback){
       var img = new Image();
       img.src = path;
       img.onload = function(){
        var that = this;
        // 默认按比例压缩
        var w = that.width,
         h = that.height,
         scale = w / h;
         w = obj.width || w;
         h = obj.height || (w / scale);
        var quality = 0.7;  // 默认图片质量为0.7
        //生成canvas
        var canvas = document.createElement('canvas');
        var ctx = canvas.getContext('2d');
        // 创建属性节点
        var anw = document.createAttribute("width");
        anw.nodeValue = w;
        var anh = document.createAttribute("height");
        anh.nodeValue = h;
        canvas.setAttributeNode(anw);
        canvas.setAttributeNode(anh); 
        ctx.drawImage(that, 0, 0, w, h);
        // 图像质量
        if(obj.quality && obj.quality <= 1 && obj.quality > 0){
         quality = obj.quality;
        }
        // quality值越小，所绘制出的图像越模糊
        var base64 = canvas.toDataURL('image/jpeg', quality );
        // 回调函数返回base64的值
        callback(base64);
       }
      }


    function birthday() {
      api.openPicker({
          type: 'date',
          date: new Date(),
          title: '选择时间'
      }, function(ret, err) {
          if (ret) {
              $api.byId('birthday').innerHTML = ret.year+'-'+ret.month+'-'+ret.day;
              var date = ret.year+'-'+ret.month+'-'+ret.day;
              
          } else {

          }
      });
    }

    function onTelClick() {
      if (data.tel) {
        rt.openPage('./cell-phone/auth_phone_frm.html',{data:data.tel});
      }else {
        rt.openPage('./cell-phone/new_phone_frm.html',{data:0});
      }
    }

    //开盘时间和结束时间
    var start = {
        format: 'YYYY-MM-DD ',
        minDate: '1222-01-01', //设定最小日期为当前日期
        isinitVal: true,
        festival: true,
        ishmsVal: false,
        maxDate: '2099-06-30 ', //最大日期
        choosefun: function(elem, datas) {
            var parames = {}
              parames.studentid=$api.getStorage('studentid');
              parames.date=datas;
              zhc.post('http://www.yxke12.com/index.php/App/Member/savememberinfo.html',parames,function(data) {
                    $api.setStorage('birthday', datas);
                    toast.success({
                        title: '保存成功',
                        duration: 2000,
                    });
              },null,true)
        }
    };
    var end = {
        format: 'YYYY-MM-DD ',
        minDate: $.nowDate(0), //设定最小日期为当前日期
        isinitVal: true,
        festival: true,
        maxDate: '2099-06-16', //最大日期
        choosefun: function(elem, datas) {
            start.maxDate = datas; //将结束日的初始值设定为开始日的最大日期
        }
    };
    
</script>
</html>
